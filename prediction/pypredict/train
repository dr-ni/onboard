#!/usr/bin/env python

# This program is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program.  If not, see <http://www.gnu.org/licenses/>.
#
# Author: marmuta <marmvta@gmail.com>
#

import sys
import pypredict
from pypredict import timeit

def main():
    global model # for debugging

    model = pypredict.DynamicModel()
    model.set_order(int(sys.argv[2]))

    with timeit("read_corpus"):
        text = pypredict.read_corpus(sys.argv[1])

    with timeit("tokenize_text"):
        tokens = pypredict.tokenize_text(text)

    with timeit("learn_tokens"):
        model.learn_tokens(tokens)

    with timeit("save"):
        model.save(sys.argv[3])

    counts, totals = model.get_counts()
    for i,c in enumerate(counts):
        print "%d-grams: types %10d, total %10d" % \
              (i+1, counts[i], totals[i])

if __name__ == '__main__':
    main()

